{% extends 'base.html' %}

{% load humanize %}

{% block title %} | Welcome {% endblock %}

{% block content %}
    <!-- Hero Section -->
    <section id="hero" class="position-relative">
        <div class="hero-overlay"></div>
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-10">
                    <div class="hero-content text-center text-white">
                        <h1 class="hero-title mb-4">Find Your Real Estate</h1>
                        <p class="hero-subtitle mb-5">
                            We are a real estate agency that will help you find the best residence you 
                            dream of, let's discuss for your dream house?
                        </p>
                        
                        <!-- Property Type Tabs -->
                        <div class="property-tabs mb-4">
                            <ul class="nav nav-pills justify-content-center" id="propertyTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link active" id="project-tab" data-toggle="pill" href="#project" role="tab" aria-controls="project" aria-selected="true">
                                        Project
                                    </a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link" id="rent-tab" data-toggle="pill" href="#rent" role="tab" aria-controls="rent" aria-selected="false">
                                        For Rent
                                    </a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link" id="sale-tab" data-toggle="pill" href="#sale" role="tab" aria-controls="sale" aria-selected="false">
                                        For Sale
                                    </a>
                                </li>
                            </ul>
                        </div>

                        <!-- Search Form -->
                        <div class="search-form-container">
                            <div class="tab-content" id="propertyTabsContent">
                                <!-- Project Tab -->
                                <div class="tab-pane fade show active" id="project" role="tabpanel" aria-labelledby="project-tab">
                                    <form action="{% url 'projects:projects' %}" method="get" class="search-form">
                                        <!-- First Row -->
                                        <div class="search-row mb-3">
                                            <div class="search-field">
                                                <div class="input-group">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">
                                                            <i class="fas fa-search text-muted"></i>
                                                        </span>
                                                    </div>
                                                    <input type="text" name="keywords" class="form-control" placeholder="Keywords (Pool, Garage, etc)">
                                                </div>
                                            </div>
                                            <div class="search-field">
                                                <div class="input-group">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">
                                                            <i class="fas fa-map-marker-alt text-muted"></i>
                                                        </span>
                                                    </div>
                                                    <input type="text" name="city" class="form-control" placeholder="City">
                                                </div>
                                            </div>
                                            <div class="search-field">
                                                <div class="input-group">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">
                                                            <i class="fas fa-map text-muted"></i>
                                                        </span>
                                                    </div>
                                                    <select name="state" class="form-control">
                                                        <option value="">Select State</option>
                                                        {% for key,value in state_choices.items %}
                                                            <option value="{{ key }}">{{ value }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Second Row -->
                                        <div class="search-row mb-4">
                                            <div class="search-field">
                                                <div class="input-group">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">
                                                            <i class="fas fa-building text-muted"></i>
                                                        </span>
                                                    </div>
                                                    <select name="project_type" class="form-control">
                                                        <option value="">Project Type</option>
                                                        <option value="residential">Residential</option>
                                                        <option value="commercial">Commercial</option>
                                                        <option value="mixed">Mixed Use</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="search-field">
                                                <div class="input-group">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">
                                                            <i class="fas fa-dollar-sign text-muted"></i>
                                                        </span>
                                                    </div>
                                                    <select name="price_range" class="form-control">
                                                        <option value="">Price Range</option>
                                                        <option value="under_1m">Under $1M</option>
                                                        <option value="1m_5m">$1M - $5M</option>
                                                        <option value="5m_10m">$5M - $10M</option>
                                                        <option value="over_10m">Over $10M</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Search Button -->
                                        <button type="submit" class="btn btn-warning btn-lg btn-block search-properties-btn">
                                            <i class="fas fa-search me-2"></i>Search Properties
                                        </button>
                                    </form>
                                </div>
                                
                                <!-- For Rent Tab -->
                                <div class="tab-pane fade" id="rent" role="tabpanel" aria-labelledby="rent-tab">
                                    <form action="{% url 'listings:search' %}" method="get" class="search-form">
                                        <input type="hidden" name="listing_type" value="rent">
                                        <!-- First Row -->
                                        <div class="search-row mb-3">
                                            <div class="search-field">
                                                <div class="input-group">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">
                                                            <i class="fas fa-search text-muted"></i>
                                                        </span>
                                                    </div>
                                                    <input type="text" name="keywords" class="form-control" placeholder="Keywords (Pool, Garage, etc)">
                                                </div>
                                            </div>
                                            <div class="search-field">
                                                <div class="input-group">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">
                                                            <i class="fas fa-map-marker-alt text-muted"></i>
                                                        </span>
                                                    </div>
                                                    <input type="text" name="city" class="form-control" placeholder="City">
                                                </div>
                                            </div>
                                            <div class="search-field">
                                                <div class="input-group">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">
                                                            <i class="fas fa-map text-muted"></i>
                                                        </span>
                                                    </div>
                                                    <select name="state" class="form-control">
                                                        <option value="">Select State</option>
                                                        {% for key,value in state_choices.items %}
                                                            <option value="{{ key }}">{{ value }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Second Row -->
                                        <div class="search-row mb-4">
                                            <div class="search-field">
                                                <div class="input-group">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">
                                                            <i class="fas fa-bed text-muted"></i>
                                                        </span>
                                                    </div>
                                                    <select name="bedrooms" class="form-control">
                                                        <option value="">Bedrooms</option>
                                                        {% for key,value in bedroom_choices.items %}
                                                            <option value="{{ key }}">{{ value }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="search-field">
                                                <div class="input-group">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">
                                                            <i class="fas fa-dollar-sign text-muted"></i>
                                                        </span>
                                                    </div>
                                                    <select name="price" class="form-control">
                                                        <option value="">Max Price</option>
                                                        {% for key,value in price_choices.items %}
                                                            <option value="{{ key }}">{{ value }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="search-field">
                                                <div class="input-group">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">
                                                            <i class="fas fa-tag text-muted"></i>
                                                        </span>
                                                    </div>
                                                    <select name="listing_type" class="form-control">
                                                        <option value="rent" selected>For Rent</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Search Button -->
                                        <button type="submit" class="btn btn-warning btn-lg btn-block search-properties-btn">
                                            <i class="fas fa-search me-2"></i>Search Properties
                                        </button>
                                    </form>
                                </div>
                                
                                <!-- For Sale Tab -->
                                <div class="tab-pane fade" id="sale" role="tabpanel" aria-labelledby="sale-tab">
                                    <form action="{% url 'listings:search' %}" method="get" class="search-form">
                                        <input type="hidden" name="listing_type" value="sale">
                                        <!-- First Row -->
                                        <div class="search-row mb-3">
                                            <div class="search-field">
                                                <div class="input-group">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">
                                                            <i class="fas fa-search text-muted"></i>
                                                        </span>
                                                    </div>
                                                    <input type="text" name="keywords" class="form-control" placeholder="Keywords (Pool, Garage, etc)">
                                                </div>
                                            </div>
                                            <div class="search-field">
                                                <div class="input-group">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">
                                                            <i class="fas fa-map-marker-alt text-muted"></i>
                                                        </span>
                                                    </div>
                                                    <input type="text" name="city" class="form-control" placeholder="City">
                                                </div>
                                            </div>
                                            <div class="search-field">
                                                <div class="input-group">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">
                                                            <i class="fas fa-map text-muted"></i>
                                                        </span>
                                                    </div>
                                                    <select name="state" class="form-control">
                                                        <option value="">Select State</option>
                                                        {% for key,value in state_choices.items %}
                                                            <option value="{{ key }}">{{ value }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Second Row -->
                                        <div class="search-row mb-4">
                                            <div class="search-field">
                                                <div class="input-group">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">
                                                            <i class="fas fa-bed text-muted"></i>
                                                        </span>
                                                    </div>
                                                    <select name="bedrooms" class="form-control">
                                                        <option value="">Bedrooms</option>
                                                        {% for key,value in bedroom_choices.items %}
                                                            <option value="{{ key }}">{{ value }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="search-field">
                                                <div class="input-group">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">
                                                            <i class="fas fa-dollar-sign text-muted"></i>
                                                        </span>
                                                    </div>
                                                    <select name="price" class="form-control">
                                                        <option value="">Max Price</option>
                                                        {% for key,value in price_choices.items %}
                                                            <option value="{{ key }}">{{ value }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="search-field">
                                                <div class="input-group">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">
                                                            <i class="fas fa-tag text-muted"></i>
                                                        </span>
                                                    </div>
                                                    <select name="listing_type" class="form-control">
                                                        <option value="sale" selected>For Sale</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Search Button -->
                                        <button type="submit" class="btn btn-warning btn-lg btn-block search-properties-btn">
                                            <i class="fas fa-search me-2"></i>Search Properties
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <br>

    <!-- Listings -->
    <section id="listings" class="py-5 bg-light">
        <div class="container">
            <div class="text-center mb-5">
                <h2 class="display-5 fw-bold text-primary mb-3">Latest Properties</h2>
                <p class="lead text-muted">Discover our newest and most exclusive property listings</p>
            </div>
            <div class="row">
                {% if listings %}
                    {% for listing in listings %}
                        {% include 'partials/_listing_card.html' %}
                    {% endfor %}
                {% else %}
                    <div class="col-12">
                        <div class="text-center py-5">
                            <i class="fas fa-home fa-4x text-muted mb-3"></i>
                            <h4 class="text-muted">No Listings Available</h4>
                            <p class="text-muted">Check back soon for new property listings!</p>
                        </div>
                    </div>
                {% endif %}
            </div>
            
            <div class="text-center mt-5">
                <a href="{% url 'listings:listings' %}" class="btn btn-primary btn-lg rounded-pill px-5">
                    View All
                </a>
            </div>
        </div>
    </section>

    <section id="services" class="py-5 bg-secondary text-white">
        <div class="container">
            <div class="row text-center">
                <div class="col-md-4">
                    <i class="fas fa-comment fa-4x mr-4"></i>
                    <hr>
                    <h3>Consulting Services</h3>
                    <p>Get expert advice on real estate investments, market analysis, and property valuation. Our experienced consultants help you make informed decisions whether you're a first-time buyer or seasoned investor.</p>
                </div>
                <div class="col-md-4">
                    <i class="fas fa-home fa-4x mr-4"></i>
                    <hr>
                    <h3>Property Management</h3>
                    <p>Comprehensive property management services including tenant screening, rent collection, maintenance coordination, and property inspections. Let us handle the day-to-day operations while you enjoy the returns.</p>
                </div>
                <div class="col-md-4">
                    <i class="fas fa-suitcase fa-4x mr-4"></i>
                    <hr>
                    <h3>Renting & Selling</h3>
                    <p>Professional buying, selling, and rental services with personalized attention. We provide market expertise, negotiation skills, and complete transaction support to ensure the best outcomes for our clients.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Newsletter Modal -->
    <div class="modal fade" id="newsletterModal" tabindex="-1" role="dialog" aria-labelledby="newsletterModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content border-0 shadow-lg" style="border-radius: 20px; overflow: hidden;">
                <button type="button" class="close position-absolute" data-dismiss="modal" aria-label="Close" style="top: 15px; right: 20px; z-index: 1000; background: rgba(255,255,255,0.9); border: none; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                    <span aria-hidden="true" style="font-size: 18px; color: #666;">&times;</span>
                </button>
                <div class="row no-gutters">
                    <!-- Left side - Image -->
                    <div class="col-md-6">
                        <div class="newsletter-image h-100" style="background-image: url('https://images.unsplash.com/photo-1512917774080-9991f1c4c750?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'); background-size: cover; background-position: center; min-height: 400px;">
                        </div>
                    </div>
                    <!-- Right side - Form -->
                    <div class="col-md-6">
                        <div class="p-5">
                            <div class="mb-3">
                                <small class="text-muted text-uppercase font-weight-bold">Weekly Updates</small>
                            </div>
                            <h3 class="mb-3 font-weight-bold" style="color: #333;">Let's join our newsletter!</h3>
                            <p class="text-muted mb-4">Do not worry we don't spam!</p>
                            
                            <form id="newsletterForm">
                                <div class="form-group">
                                    <label for="email" class="font-weight-bold" style="color: #333;">Email Address <span class="text-danger">*</span></label>
                                    <div class="input-group">
                                        <input type="email" class="form-control form-control-lg" id="email" name="email" placeholder="Enter Your Email" required style="border: 2px solid #e0e0e0; border-radius: 8px; height: 50px;">
                                        <div class="input-group-append">
                                            <span class="input-group-text bg-danger text-white" style="border: 2px solid #dc3545; border-left: none; border-radius: 0 8px 8px 0;">
                                                <i class="fas fa-envelope"></i>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                
                                <button type="submit" class="btn btn-danger btn-lg btn-block mb-4" style="height: 50px; border-radius: 8px; font-weight: bold;">
                                    Subscribe
                                </button>
                                
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="dontShowAgain">
                                    <label class="form-check-label text-muted" for="dontShowAgain">
                                        Don't show this popup again
                                    </label>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block styles %}
<style>
    #hero {
        background-image: url('https://images.unsplash.com/photo-1512917774080-9991f1c4c750?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D');
        background-size: cover;
        background-position: center;
        min-height: 70vh;
        display: flex;
        align-items: center;
        padding: 60px 0;
    }
    
    .hero-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1;
    }
    
    .hero-content {
        position: relative;
        z-index: 2;
    }
    
    .hero-title {
        font-size: 3.5rem;
        font-weight: 700;
        margin-bottom: 1.5rem;
    }
    
    .hero-subtitle {
        font-size: 1.2rem;
        line-height: 1.8;
        opacity: 0.9;
        max-width: 600px;
        margin: 0 auto;
    }
    
    .property-tabs .nav-pills {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 8px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .property-tabs .nav-link {
        color: rgba(255, 255, 255, 0.8);
        background: none;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        font-weight: 500;
        transition: all 0.3s ease;
    }
    
    .property-tabs .nav-link:hover {
        color: white;
        background: rgba(255, 255, 255, 0.1);
    }
    
    .property-tabs .nav-link.active {
        color: white;
        background: rgba(255, 255, 255, 0.2);
        font-weight: 600;
    }
    
    .search-form-container {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        max-width: 900px;
        margin: 0 auto;
    }
    
    .search-row {
        display: flex;
        gap: 15px;
        align-items: stretch;
    }
    
    .search-field {
        flex: 1;
        position: relative;
    }
    
    .search-field .input-group {
        height: 50px;
    }
    
    .search-field .input-group-text {
        background: #f8f9fa;
        border: 2px solid #e0e0e0;
        border-right: none;
        color: #6c757d;
        font-size: 16px;
        width: 45px;
        justify-content: center;
        border-radius: 8px 0 0 8px;
    }
    
    .search-field .form-control {
        height: 50px;
        border: 2px solid #e0e0e0;
        border-left: none;
        border-radius: 0 8px 8px 0;
        padding: 0 15px;
        font-size: 16px;
        background: #f8f9fa;
        transition: all 0.3s ease;
    }
    
    .search-field .form-control:focus {
        border-color: #007bff;
        background: white;
        box-shadow: none;
    }
    
    .search-field .form-control:focus + .input-group-text,
    .search-field .input-group:focus-within .input-group-text {
        border-color: #007bff;
        background: white;
    }
    
    .search-field .form-control::placeholder {
        color: #6c757d;
        font-size: 15px;
    }
    
    .search-properties-btn {
        background: #f4a261;
        border: 2px solid #f4a261;
        border-radius: 10px;
        font-weight: 600;
        font-size: 18px;
        padding: 12px 0;
        transition: all 0.3s ease;
        color: white;
        text-transform: none;
        letter-spacing: 0.5px;
    }
    
    .search-properties-btn:hover {
        background: #e76f51;
        border-color: #e76f51;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(244, 162, 97, 0.4);
        color: white;
    }
    
    @media (max-width: 768px) {
        .hero-title {
            font-size: 2.5rem;
        }
        
        .hero-subtitle {
            font-size: 1rem;
        }
        
        .search-row {
            flex-direction: column;
            gap: 15px;
        }
        
        .search-form-container {
            padding: 20px;
            margin: 0 15px;
        }
        
        .property-tabs .nav-link {
            padding: 10px 16px;
            font-size: 14px;
        }
        
        #hero {
            min-height: 60vh;
            padding: 40px 0;
        }
        
        .search-field .form-control,
        .search-field .input-group-text {
            height: 45px;
        }
        
        .search-properties-btn {
            font-size: 16px;
            padding: 10px 0;
        }
    }
    
    @media (max-width: 576px) {
        .hero-title {
            font-size: 2rem;
        }
        
        .property-tabs .nav-pills {
            padding: 6px;
        }
        
        .property-tabs .nav-link {
            padding: 8px 12px;
            font-size: 13px;
        }
        
        .search-field .form-control,
        .search-field .input-group-text {
            height: 40px;
            font-size: 14px;
        }
        
        .search-field .input-group-text {
            width: 40px;
        }
        
        .search-properties-btn {
            font-size: 15px;
        }
    }

    .modal-content {
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    }

    .newsletter-image {
        position: relative;
    }

    .newsletter-image::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.3) 100%);
    }

    #newsletterForm .form-control:focus {
        border-color: #dc3545;
        box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
    }

    .btn-danger:hover {
        background-color: #c82333;
        border-color: #bd2130;
        transform: translateY(-1px);
        transition: all 0.3s ease;
    }

    @media (max-width: 768px) {
        .modal-dialog {
            margin: 1rem;
        }
        
        .newsletter-image {
            min-height: 200px;
        }
        
        .modal-content .p-5 {
            padding: 2rem !important;
        }
    }
    </style>
{% endblock %}

{% block scripts %}
    <script>
    // Use jQuery's document ready instead of DOMContentLoaded since Bootstrap uses jQuery
    $(document).ready(function() {
        // Check if user has chosen not to show the modal again
        const dontShowAgain = localStorage.getItem('newsletterModalDontShow');
        
        // Show modal after 2 seconds if not disabled
        if (!dontShowAgain) {
            setTimeout(function() {
                $('#newsletterModal').modal('show');
            }, 2000);
        }
        
        // Handle form submission
        $('#newsletterForm').on('submit', function(e) {
            e.preventDefault();
            console.log('Newsletter form submitted');
            
            const email = $('#email').val();
            const dontShow = $('#dontShowAgain').is(':checked');
            
            console.log('Email:', email, 'DontShow:', dontShow);
            
            // Store preference if checkbox is checked
            if (dontShow) {
                localStorage.setItem('newsletterModalDontShow', 'true');
                console.log('User preference saved - will not show modal again');
            }
            
            // Here you would typically send the email to your backend
            // For now, we'll just show a success message and close the modal
            alert('Thank you for subscribing to our newsletter!');
            $('#newsletterModal').modal('hide');
            
            // Reset form
            this.reset();
        });
        
        // Handle modal close with "don't show again" option
        $('#newsletterModal').on('hidden.bs.modal', function() {
            const dontShow = $('#dontShowAgain').is(':checked');
            if (dontShow) {
                localStorage.setItem('newsletterModalDontShow', 'true');
                console.log('Modal closed - User preference to not show again saved');
            }
        });
    });
    </script>
{% endblock %}